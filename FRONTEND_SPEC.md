# フロントエンド仕様（現行）

対象: `src/index.html`

## 1. 概要
- 1ページ完結のチャットUI。
- WebSocketに接続してメッセージを受信・送信。
- 絵文字リアクションはCanvas上にフロート表示。

## 2. 画面構成
- メッセージ一覧（縦スクロール）
- 入力エリア（下部固定）
  - 絵文字ボタン（リアクション）
  - 表示名入力
  - メッセージ入力
  - ヒント表示

## 3. レイアウト/見た目
- 画面全体にパネルがフィット（上下余白なし、左右のみ余白）。
- スクロールはメッセージ領域のみ。
- メッセージカードは枠線のみ（影なし）。
- スクロールバーは非表示。
- 背景は透明。

## 4. 接続先
- WebSocket: `wss://websocket-server-on-heroku-ec91325c1c49.herokuapp.com/`

## 5. URLパラメータ
- `/?mode=view`
  - 入力欄を非表示（閲覧専用）
  - 送信・絵文字送信は無効

## 6. 入力・送信
- 送信ショートカット: Enterで送信、Shift+Enterで改行。
- IME入力中のEnterは送信しない。
- 未入力（空白のみ）の送信は無視。
- 送信ペイロード:
  ```json
  { "name": "guest", "text": "hello" }
  ```

## 7. スーパーチャット（隠し機能）
- 送信テキストに以下形式が含まれるとスーパーチャット扱い。
  - `/sc<金額> 本文`
  - `[SC:<金額>] 本文`
- 表示時は上記プレフィックスを除去して本文のみ表示。
- 金額に応じて背景色を変更し、名前の右に金額チップ表示。

### 色帯（band）
- 100–199: 青
- 200–499: 水色
- 500–999: 黄緑
- 1000–1999: 黄色
- 2000–4999: オレンジ
- 5000–9999: マゼンタ
- 10000以上: 赤

## 8. 絵文字リアクション
- ボタン送信、またはコマンド `/e <emoji>` で送信。
- 受信した `/e` はチャットに表示せず、Canvas上にフロート表示。
- Canvasは全画面固定レイヤー。
- 描画最適化:
  - 絵文字はサイズ別にスプライト化してキャッシュ。
  - `requestAnimationFrame`でまとめて描画。
  - タブ非表示時は描画停止。

## 9. 受信イベントの扱い
- `backlog`: メッセージ一覧を初期化して順次描画。
- `message`: 通常メッセージまたはスーパーチャットとして描画。
- `/e`メッセージはチャットに残さない（絵文字のみ）。

## 10. 既知の制約
- 表示はフロントのみで完結（サーバ側のUI制御なし）。
- 絵文字の見た目は端末フォントに依存。
